var geolocs = [[-119.57,34.472],[-119.513,34.4687],[-119.446,34.4759],[-119.507,34.4691],[-119.572,34.4733],[-119.573,34.4745],[-119.571,34.4721],[-119.507,34.4692],[-119.531,34.4678],[-119.513,34.4687],[-119.57,34.4719],[-119.574,34.4764],[-119.446,34.476],[-119.446,34.4759],[-119.507,34.4693],[-119.569,34.4698],[-119.572,34.4734],[-119.568,34.4709],[-119.472,34.472],[-119.528,34.4676],[-119.57,34.4686],[-119.569,34.4697],[-119.577,34.4804],[-119.531,34.4678],[-119.575,34.476],[-119.571,34.4725],[-119.574,34.4763],[-119.455,34.4765],[-119.574,34.4764],[-119.445,34.4765],[-119.574,34.4741],[-119.513,34.4687],[-119.562,34.4651],[-119.464,34.4754],[-119.522,34.4674],[-119.447,34.4757],[-119.576,34.4756],[-119.57,34.4719],[-119.577,34.4804],[-119.574,34.4761],[-119.575,34.4785],[-119.569,34.471],[-119.573,34.4746],[-119.507,34.4688],[-119.478,34.4713],[-119.527,34.4666],[-119.496,34.4655],[-119.507,34.4688],[-119.575,34.4759],[-119.574,34.4771],[-119.544,34.4696],[-119.449,34.4763],[-119.57,34.4717],[-119.575,34.476],[-119.568,34.4709],[-119.465,34.4752],[-119.531,34.4679],[-119.553,34.4642],[-119.5,34.4654],[-119.552,34.4682],[-119.451,34.4762],[-119.574,34.4781],[-119.446,34.4759],[-119.511,34.4692],[-119.518,34.4693],[-119.48,34.4717],[-119.551,34.4645],[-119.574,34.4741],[-119.476,34.4702],[-119.574,34.4771],[-119.485,34.4694],[-119.504,34.4669],[-119.572,34.4735],[-119.576,34.4752],[-119.569,34.4711],[-119.574,34.4741],[-119.575,34.4747],[-119.529,34.4675],[-119.57,34.4711],[-119.472,34.4722],[-119.475,34.4695],[-119.456,34.4768],[-119.55,34.4659],[-119.561,34.465],[-119.485,34.4682],[-119.465,34.4752],[-119.572,34.4741],[-119.568,34.4709],[-119.465,34.4752],[-119.574,34.4739],[-119.502,34.4667],[-119.502,34.4665],[-119.456,34.4767],[-119.575,34.476],[-119.575,34.476],[-119.573,34.4745],[-119.57,34.4718],[-119.574,34.474],[-119.573,34.4744],[-119.534,34.4684],[-119.445,34.4763],[-119.57,34.4718],[-119.575,34.476],[-119.57,34.472],[-119.571,34.4723],[-119.564,34.4665],[-119.445,34.4765],[-119.57,34.4711],[-119.565,34.4672],[-119.574,34.4785],[-119.576,34.4757],[-119.518,34.4694],[-119.495,34.4657],[-119.564,34.4665],[-119.503,34.4666],[-119.465,34.4753],[-119.558,34.4644],[-119.531,34.4689],[-119.507,34.4693],[-119.47,34.4739],[-119.445,34.4763],[-119.467,34.4745],[-119.524,34.4661],[-119.571,34.4724],[-119.575,34.4747],[-119.575,34.476],[-119.574,34.4783],[-119.573,34.4745],[-119.574,34.4772],[-119.569,34.4698],[-119.551,34.4662],[-119.574,34.4741],[-119.569,34.4712],[-119.553,34.4641],[-119.503,34.4665],[-119.567,34.4707],[-119.491,34.4664],[-119.567,34.4703],[-119.499,34.4655],[-119.576,34.4753],[-119.571,34.4724],[-119.575,34.4788],[-119.572,34.4744],[-119.461,34.4759],[-119.507,34.4685],[-119.573,34.4745],[-119.487,34.4666],[-119.573,34.4744],[-119.552,34.4669]];
var species = [2189,2231,2276,1621,1804,2531,1910,2472,2584,1997,1998,1999,1854,1600,1715,1716,1717,1759,1597,1935,1937,1796,2265,2266,2269,2271,1802,2277,2080,1799,2361,2363,2165,2166,2074,2332,1898,1718,2294,1959,1963,2320,1902,1904,1610,2321,2173,1719,1968,1970,2087,2088,1772,2142,2273,1890,1857,1859,1849,1850,1851,1731,2147,1667,2280,1914,1915,2198,2013,1845,2211,2215,2219,1779,1817,2191,2193,1973,2253,2396,1900,1689,2524,1617,1917,1622,1976,1980,1982,2241,1612,1611,2285,1749,1750,2358,2254,2260,1822,2275,2185,2034,1877,1880,1881,1883,1843,1696,1794,1953,1826,1829,1703,2135,2188,1683,1888,2339,1833,2403];

$(document).ready(function() {
	var vectorSource = new ol.source.Vector({
      //create empty vector
    });

	//create a bunch of icons and add to source vector
	geolocs.forEach(function(item,index) {
		var iconFeature = new ol.Feature({
		          geometry: new  
		            ol.geom.Point(ol.proj.fromLonLat(item)),
		        name: 'Flower',
		        coords: 'hi' 
		});
		vectorSource.addFeature(iconFeature);
	});

    //create the style
    var iconStyle = new ol.style.Style({
      image: new ol.style.Icon( ({
        anchor: [0.5, 46],
        anchorXUnits: 'fraction',
        anchorYUnits: 'pixels',
        opacity: 0.75,
        src: '../flower.png'
      }))
    });

    //add the feature vector to the layer vector, and apply a style to whole layer
    var vectorLayer = new ol.layer.Vector({
      source: vectorSource,
      style: iconStyle
    });

	var attribution = new ol.control.Attribution({
	     collapsible: false
	 });

	 var map = new ol.Map({
	     controls: ol.control.defaults({attribution: false}).extend([attribution]),
	     layers: [
	         new ol.layer.Tile({
	             source: new ol.source.OSM()
	         }),
	         vectorLayer
	     ],
	     target: 'map',
	     view: new ol.View({
	         center: ol.proj.fromLonLat([-119.644, 34.5158]),
	         zoom: 15,
	         maxZoom: 20
	     })
	 });

	// display popup on click
	map.on('click', function (evt) {
	  var feature = map.forEachFeatureAtPixel(evt.pixel, function (feature) {
	    return feature;
	  });
	  console.log($(element));
	  if (feature) {
	    var coordinates = feature.getGeometry().getCoordinates();
	    var lonlat = ol.proj.transform(coordinates, 'EPSG:3857', 'EPSG:4326');
	    console.log(lonlat);
	  }
	});

	var extent = vectorLayer.getSource().getExtent();
	map.getView().fit(extent, map.getSize());
});