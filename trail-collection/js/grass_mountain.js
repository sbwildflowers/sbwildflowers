var geolocs = [[-120.048,34.7458],[-120.062,34.737],[-120.053,34.7548],[-120.056,34.7508],[-120.057,34.751],[-120.052,34.7536],[-120.052,34.7533],[-120.057,34.7428],[-120.048,34.7447],[-120.054,34.7516],[-120.057,34.753],[-120.068,34.7595],[-120.057,34.7516],[-120.057,34.7462],[-120.049,34.7441],[-120.045,34.7613],[-120.069,34.7594],[-120.057,34.7516],[-120.053,34.7545],[-120.052,34.7534],[-120.042,34.7626],[-120.045,34.7614],[-120.06,34.754],[-120.056,34.747],[-120.051,34.7592],[-120.059,34.7556],[-120.053,34.7537],[-120.056,34.7571],[-120.06,34.7432],[-120.059,34.7448],[-120.054,34.7432],[-120.056,34.7508],[-120.058,34.7418],[-120.051,34.747],[-120.053,34.7438],[-120.053,34.7481],[-120.053,34.7555],[-120.054,34.7515],[-120.061,34.7419],[-120.052,34.7532],[-120.056,34.7522],[-120.057,34.7459],[-120.056,34.7553],[-120.054,34.7482],[-120.056,34.7554],[-120.056,34.7464],[-120.063,34.7587],[-120.063,34.7384],[-120.054,34.7482],[-120.045,34.7612],[-120.058,34.758],[-120.062,34.7574],[-120.058,34.758],[-120.059,34.7444],[-120.052,34.7535],[-120.057,34.751],[-120.068,34.7596],[-120.057,34.7516],[-120.051,34.7469],[-120.054,34.7516],[-120.064,34.7603],[-120.053,34.7568],[-120.059,34.7555],[-120.06,34.7563],[-120.061,34.742],[-120.059,34.7553],[-120.054,34.7516],[-120.056,34.7508],[-120.06,34.7439],[-120.059,34.7447],[-120.045,34.7615],[-120.068,34.7594],[-120.052,34.7535],[-120.058,34.7577],[-120.056,34.7571],[-120.05,34.7472],[-120.057,34.7531],[-120.068,34.7595],[-120.053,34.7563],[-120.057,34.7542],[-120.064,34.7603],[-120.057,34.7427],[-120.042,34.7621],[-120.049,34.7441],[-120.06,34.7432],[-120.053,34.7564],[-120.061,34.7427],[-120.058,34.7581],[-120.058,34.7449],[-120.052,34.7578],[-120.061,34.74],[-120.05,34.747],[-120.053,34.7517],[-120.057,34.751],[-120.068,34.7594],[-120.059,34.7529],[-120.061,34.7396],[-120.056,34.7564],[-120.058,34.741],[-120.061,34.7422],[-120.054,34.7495],[-120.057,34.751],[-120.068,34.7596],[-120.056,34.7495],[-120.047,34.7609],[-120.061,34.739],[-120.045,34.7615],[-120.056,34.7474],[-120.049,34.7609],[-120.042,34.7625],[-120.056,34.7518],[-120.064,34.7598],[-120.056,34.7507],[-120.049,34.7445],[-120.045,34.7616],[-120.059,34.7443],[-120.059,34.7561],[-120.055,34.7483],[-120.053,34.7566],[-120.055,34.7481],[-120.06,34.7397],[-120.055,34.7477],[-120.053,34.7541],[-120.052,34.7532],[-120.061,34.7429],[-120.06,34.7434],[-120.059,34.7445],[-120.052,34.7476],[-120.059,34.7444],[-120.054,34.7496],[-120.055,34.7486],[-120.054,34.7483],[-120.056,34.756],[-120.053,34.7538],[-120.058,34.7579],[-120.054,34.7486],[-120.056,34.752],[-120.057,34.7428],[-120.052,34.7523],[-120.053,34.7537],[-120.054,34.7429],[-120.052,34.7579],[-120.054,34.7485],[-120.053,34.7546],[-120.051,34.747],[-120.053,34.7438],[-120.064,34.7595],[-120.057,34.7507],[-120.059,34.7444],[-120.053,34.7517],[-120.056,34.7508],[-120.057,34.751],[-120.068,34.7596],[-120.056,34.7466],[-120.059,34.7552],[-120.055,34.7429],[-120.056,34.7464],[-120.057,34.7542],[-120.042,34.7621],[-120.056,34.7548],[-120.062,34.7411],[-120.053,34.7438],[-120.054,34.7494],[-120.066,34.7609],[-120.056,34.7491],[-120.052,34.7532],[-120.063,34.737],[-120.056,34.747],[-120.061,34.7421],[-120.054,34.7495],[-120.057,34.7542],[-120.065,34.7603],[-120.056,34.7491],[-120.052,34.7532],[-120.049,34.746],[-120.049,34.7461],[-120.056,34.757],[-120.051,34.7597],[-120.063,34.7385],[-120.052,34.7541],[-120.056,34.757],[-120.054,34.7434],[-120.056,34.7554],[-120.056,34.7466],[-120.052,34.7541],[-120.056,34.757],[-120.049,34.7447],[-120.066,34.76],[-120.054,34.7482],[-120.056,34.7569],[-120.048,34.7455],[-120.064,34.7603],[-120.054,34.7514],[-120.056,34.752],[-120.056,34.7504],[-120.047,34.7447],[-120.064,34.7597],[-120.06,34.7433],[-120.062,34.7414],[-120.056,34.7554],[-120.063,34.7372],[-120.053,34.7537],[-120.063,34.7389],[-120.046,34.761],[-120.058,34.7577],[-120.064,34.7603],[-120.052,34.7574],[-120.057,34.7542],[-120.056,34.743],[-120.06,34.743],[-120.052,34.7538],[-120.055,34.7486],[-120.059,34.7554],[-120.065,34.7606],[-120.062,34.7371],[-120.048,34.7447]];
var species = [1705,2233,1835,2276,1621,1664,2252,1955,1909,1698,1998,1999,2746,1707,1600,1715,1717,2113,2069,1672,1935,2117,2118,1892,1895,2266,2277,2052,2074,1913,1718,1962,1963,1945,1670,2026,2088,1772,2142,2324,1972,2273,1680,1858,1859,1860,1863,2012,1731,1667,2280,2125,1653,1865,1774,2198,2040,1702,2211,2213,2217,2226,2227,2228,2191,2193,1713,2242,2245,2041,1838,1820,1689,2037,1617,1618,1622,1987,1989,1991,2182,1922,2317,2330,1612,2254,2257,1822,2368,2337,2275,2034,2036,2307,1880,1882,1885,1843,1695,1696,1697,1607,1684,1949,1869,2067,1605,2135,2188,1683,2136,1833,2310];

$(document).ready(function() {
	var vectorSource = new ol.source.Vector({
      //create empty vector
    });

	//create a bunch of icons and add to source vector
	geolocs.forEach(function(item,index) {
		var iconFeature = new ol.Feature({
		          geometry: new  
		            ol.geom.Point(ol.proj.fromLonLat(item)),
		        name: 'Flower',
		        coords: 'hi' 
		});
		vectorSource.addFeature(iconFeature);
	});

    //create the style
    var iconStyle = new ol.style.Style({
      image: new ol.style.Icon( ({
        anchor: [0.5, 46],
        anchorXUnits: 'fraction',
        anchorYUnits: 'pixels',
        opacity: 0.75,
        src: '../flower.png'
      }))
    });

    //add the feature vector to the layer vector, and apply a style to whole layer
    var vectorLayer = new ol.layer.Vector({
      source: vectorSource,
      style: iconStyle
    });

	var attribution = new ol.control.Attribution({
	     collapsible: false
	 });

	 var map = new ol.Map({
	     controls: ol.control.defaults({attribution: false}).extend([attribution]),
	     layers: [
	         new ol.layer.Tile({
	             source: new ol.source.OSM()
	         }),
	         vectorLayer
	     ],
	     target: 'map',
	     view: new ol.View({
	         center: ol.proj.fromLonLat([-119.644, 34.5158]),
	         zoom: 15,
	         maxZoom: 20
	     })
	 });

	// display popup on click
	map.on('click', function (evt) {
	  var feature = map.forEachFeatureAtPixel(evt.pixel, function (feature) {
	    return feature;
	  });
	  console.log($(element));
	  if (feature) {
	    var coordinates = feature.getGeometry().getCoordinates();
	    var lonlat = ol.proj.transform(coordinates, 'EPSG:3857', 'EPSG:4326');
	    console.log(lonlat);
	  }
	});

	var extent = vectorLayer.getSource().getExtent();
	map.getView().fit(extent, map.getSize());
});